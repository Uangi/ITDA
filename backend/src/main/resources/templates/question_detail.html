<html layout:decorate="~{layout}">
<meta charset="UTF-8">

<div layout:fragment="content" class="container my-3">

	<h2 class="border-bottom py-2" th:text="${question.subject}"></h2>
	<div class="card my-3">
		<div class="card-body">
	
			<!-- ì£¼ì†Œì— urlì´ í¬í•¨ë˜ì–´ìˆìœ¼ë©´ utextë¡œ ë³€ê²½ -->
			<!-- ìƒì„±ëœ ê°ì²´ commonUtilì˜ markdown() ì•ˆì— ì§ˆë¬¸ë‚´ìš© ì ì–´ì£¼ê¸°  -->
			<div class="card-text" th:utext="${@commonUtil.markdown(question.content)}"></div>
			<div class="d-flex justify-content-end">
			
			<!-- ì§ˆë¬¸ ìˆ˜ì •ì¼ -->
			
			<div th:if="${question.modifyDate!=null}" class="badge bg-light text-dark p-2 text-start mx-3">
				<div class="mb-2">ìˆ˜ì •ì¼ : </div>
				<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ x ë”°ë¡œ ì„¤ì¹˜ x - ${#temporals.} : ë‚ ì§œë¥¼ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì¹œêµ¬ -->
				<div th:text="${#temporals.format(question.modifyDate, 'yyyy-MM-dd HH:mm')}"></div>
			</div>
			
			<!-- ì§ˆë¬¸ ì…ë ¥ì¼ -->
			
			<div class="badge bg-light text-dark p-2 text-start">
			
				<div class="mb-2">
						<span th:if="${question.author!=null}" 
						th:text="${question.author.userName}">
						</span>
				</div>
			
				<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ x ë”°ë¡œ ì„¤ì¹˜ x - ${#temporals.} : ë‚ ì§œë¥¼ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì¹œêµ¬ -->
				<div th:text="${#temporals.format(question.createdData, 'yyyy-MM-dd HH:mm')}"></div>
			</div>
		</div>
		
			<!-- ì§ˆë¬¸ ìˆ˜ì • -->
				<div class="my-3">
						
					<!-- ì¢‹ì•„ìš” í‘œì‹œ -->	
					<!--${#lists.size(question.voter)} =  Questionì•ˆì— ìˆëŠ” voteì˜ ê°œìˆ˜ë¥¼ countí•´ì„œ ë³´ì—¬ì¤„ê±°ì„ -->
					<a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary"
					th:data-uri="@{|/question/vote/${question.id}|}">ğŸ˜ğŸ‘
					<span class="badge rounded-pill bg-success" th:text="${#lists.size(question.voter)}"></span>
					</a>
				
					<a th:href="@{|/question/modify/${question.id}|}" class="btn btn-sm btn-outline-secondary"
					sec:authorize="isAuthenticated()" th:if="${question.author!=null and #authentication.getPrincipal().
					getUsername()==question.author.userName}" th:text="ìˆ˜ì •"></a>
				
				
					<a href="javascript:void(0)" th:data-uri="@{|/question/delete/${question.id}|}" 
					class="delete btn btn-sm btn-outline-secondary" sec:authorize="isAuthenticated()"
					th:if="${question.author!=null and #authentication.getPrincipal().getUsername()==question.author.userName}"
					th:text="ì‚­ì œ"></a>
			</div>
		</div>
	</div>
	
	<!-- answer.javaì— ìˆëŠ” List<Answer>ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ë©´ ë¨ -->
	<!-- ë„˜ì–´ì˜¤ëŠ” listsì˜ ì‚¬ì´ì¦ˆ -->
	<h5 class="border-bottom my-3 py-2"
	th:text="|${#lists.size(question.answerList)}ê°œì˜ ë‹µë³€ì´ ìˆìŠµë‹ˆë‹¤.|">
	</h5>
	
	<div class="card my-3" th:each="answer : ${question.answerList}">
	
		<a th:id="|answer_${answer.id}|"></a>
	
		<div class="card-body">
			<div class="card-text" th:utext="${@commonUtil.markdown(answer.content)}"></div>
			
			<div class="d-flex justify-content-end">
			
				<!-- ë‹µë³€ìˆ˜ì •ì¼ -->
				<div th:if="${answer.modifyDate!=null}" class="badge bg-light text-dark p-2 text-start mx-3">
					<div class="mb-2">ìˆ˜ì •ì¼: </div>
					<div th:text="${#temporals.format(answer.modifyDate,'yyyy-MM-dd HH:mm')}"></div>
				</div>
			
				<div class="badge bg-light text-dark p-2 text-start">
					<!-- ì´ë¦„ -->
					<div class="mb-2">
						<span th:if="${answer.author!=null}" 
						th:text="${answer.author.userName}">
						</span>
					</div>
					<!-- ë‚ ì§œ -->
					<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ x ë”°ë¡œ ì„¤ì¹˜ x - ${#temporals.} : ë‚ ì§œë¥¼ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì¹œêµ¬ -->
					<div th:text="${#temporals.format(answer.createdData,'yyyy-MM-dd HH:mm')}"></div>
				</div>
				
			</div>
		
				<div class="my-3">

					<!-- ì¢‹ì•„ìš” í‘œì‹œ -->	
					<!--${#lists.size(answer.voter)} =  Questionì•ˆì— ìˆëŠ” voteì˜ ê°œìˆ˜ë¥¼ countí•´ì„œ ë³´ì—¬ì¤„ê±°ì„ -->
					<a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary"
					th:data-uri="@{|/answer/vote/${answer.id}|}">ğŸ˜ğŸ‘
					<span class="badge rounded-pill bg-success" th:text="${#lists.size(answer.voter)}"></span>
					</a>

			<!-- ë‹µë³€ ìˆ˜ì • -->
				
					<a th:href="@{|/answer/modify/${answer.id}|}" class="btn btn-sm btn-outline-secondary"
						sec:authorize="isAuthenticated()" th:if="${answer.author!=null and #authentication.getPrincipal().
						getUsername()==answer.author.userName}" th:text="ìˆ˜ì •"></a>
		
			<!-- ë‹µë³€ ì‚­ì œ -->
				<a href="javascript:void(0);" th:data-uri="@{|/answer/delete/${answer.id}|}" class="delete btn btn-sm btn-outline-secondary"
					sec:authorize="isAuthenticated()" th:if="${answer.author!=null and #authentication.getPrincipal().
					getUsername()==answer.author.userName}" th:text="ì‚­ì œ"></a>
			
			
			
				</div>
		</div>
	</div>
	
	
	<!-- ë‹µë³€ì„ ë‹¬ ë•ŒëŠ” ë¶€ëª¨ì˜ ë²ˆí˜¸ë¥¼ ì•Œê³ ìˆê³ , ê°€ì§€ê³ ìˆì–´ì•¼í•¨ -->
	<!-- ê·¸ë˜ì„œ ë¶€ëª¨ì˜ idë¥¼ ë„˜ê²¨ì•¼ì§€ answer.javaì˜ questionìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆìŒ -->
	<form th:action="@{|/answer/create/${question.id}|}" th:object="${answerForm}" method="post" class="my-3">
	
	<!-- ì—ëŸ¬ë©”ì„¸ì§€ -->
		<div th:replace="form_errors :: formErrorsFragment"></div>
	
	<br/>
		<!-- answer.javaì— contentë¡œ ë§Œë“¤ì–´ë†“ìŒ -->
		<!-- idëŠ” ì•ì— <div>ë¡œ ì½ì–´ì˜¬ê±°ì„ -->
		<!-- rows ê°€ë¡œ ë‘ê»˜ 10-->
		
		<!-- ì¸ì¦ì´ ì•ˆëìœ¼ë©´ ì´ê±¸ ë„ìš°ê³  / disabled = ì°½ì„ ì ê¶ˆë¼ -->
		<textarea sec:authorize="isAnonymous()" disabled="disabled" rows="10" th:field="*{content}" class="form-control"></textarea>
		
		<!-- ì¸ì¦ì´ ëìœ¼ë©´ ì´ê±¸ ë„ì›Œ -->
		<textarea sec:authorize="isAuthenticated()" rows="10" th:field="*{content}" class="form-control"></textarea>
		
		<input type="submit" value="ë‹µë³€ë“±ë¡" class="btn btn-primary my-2"/>
	</form>
</div>


<script type="text/javascript" layout:fragment="deleteScript">

	//deleteì´ë¦„ê°€ì§„ê±° ëª½ë•… ê°€ì§€ê³ ì™€ì„œ deleteBtnì— ë‹´ì•„ë‘ 
	const deleteBtn = document.getElementsByClassName("delete");
	
	//deleteBtnì´ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì—¬ëŸ¬ê°œì˜ ë²„íŠ¼ì„ arrayë°°ì—´ì•ˆì— ë„£ìŒ
	//ë°˜ë³µë¬¸ìœ¼ë¡œ btnì´ë¦„ìœ¼ë¡œ í•˜ë‚˜ì”© êº¼ëƒ„
	Array.from(deleteBtn).forEach(function(btn){
		
		//ë¹„ë™ê¸°ë°©ì‹
		//í´ë¦­í–ˆìœ¼ë©´ functioní•¨ìˆ˜ ì‹¤í–‰í•´
		btn.addEventListener('click',function(){
			
			if(confirm("ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ")){
				
				//ì£¼ì†Œ = data-uriì½ì–´ì˜¤ë©´ ë¨
				//ì–´ë–»ê²Œ? this.dataset.uri;ì´ë ‡ê²Œ!
				location.href=this.dataset.uri;
			}
			
		});
		
	});

	const recommendBtn = document.getElementsByClassName("recommend");
	
	Array.from(recommendBtn).forEach(function(btn){
		
		btn.addEventListener('click',function(){

			if(confirm("ê²Œì‹œê¸€ì„ ğŸ˜ğŸ‘ğŸ‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ")){
				
				//ì£¼ì†Œ = data-uriì½ì–´ì˜¤ë©´ ë¨
				location.href=this.dataset.uri;
			}
			
		});
		
	});
	
	

</script>

</html>
